// Social media data loader for static JSON file
// This script loads comprehensive social media profile data from the JSON file generated by GitHub Actions

// Configuration
const CONFIG = {
    dataUrl: 'social_data.json',    // Path to the JSON file with social media data
    showChanges: false              // No animations for count changes
};

// Function to fetch the social media data from JSON file
async function fetchSocialData() {
    try {
        // Add cache-busting parameter to avoid browser caching
        const cacheBuster = new Date().getTime();
        const response = await fetch(`${CONFIG.dataUrl}?_=${cacheBuster}`);

        if (!response.ok) {
            throw new Error(`Failed to fetch social data: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching social media data:', error);
        return null;
    }
}

// Function to update the Instagram panel with profile data
function updateInstagramPanel(data) {
    if (!data || !data.instagram) return;

    const instagram = data.instagram;

    // Update Instagram profile name
    const nameElement = document.querySelector('.profilePanel:nth-child(2) .profileName');
    if (nameElement && instagram.username) {
        nameElement.textContent = instagram.username;
    }

    // Update Instagram profile username
    const usernameElement = document.querySelector('.profilePanel:nth-child(2) #profileLoc');
    if (usernameElement && instagram.username) {
        usernameElement.textContent = `@${instagram.username}`;
    }

    // Update Instagram bio (if available)
    const bioElement = document.querySelector('.profilePanel:nth-child(2) #profileStatus');
    if (bioElement && instagram.biography) {
        bioElement.textContent = instagram.biography;
    }

    // Update Instagram stats
    const statsElements = document.querySelectorAll('.profilePanel:nth-child(2) .socialButtons #numberTitle');
    if (statsElements.length >= 3) {
        // Update posts count
        if (instagram.media_count !== undefined && statsElements[0]) {
            statsElements[0].textContent = instagram.media_count;
        }

        // Update followers count
        if (instagram.followers !== undefined && statsElements[1]) {
            statsElements[1].textContent = instagram.followers;
        }

        // Update following count
        if (instagram.following !== undefined && statsElements[2]) {
            statsElements[2].textContent = instagram.following;
        }
    }

    // Update Instagram profile picture (if path provided)
    if (instagram.profile_image_path) {
        const imgElement = document.querySelector('.profilePanel:nth-child(2) .profileImg');
        if (imgElement) {
            imgElement.src = instagram.profile_image_path;
        }
    }
}

// Function to update the Twitter panel with profile data
function updateTwitterPanel(data) {
    if (!data || !data.twitter) return;

    const twitter = data.twitter;

    // Update Twitter profile name
    const nameElement = document.querySelector('.profilePanel:nth-child(3) .profileName');
    if (nameElement && twitter.name) {
        nameElement.textContent = twitter.name;
    }

    // Update Twitter profile username
    const usernameElement = document.querySelector('.profilePanel:nth-child(3) #profileLoc');
    if (usernameElement && twitter.username) {
        usernameElement.textContent = `@${twitter.username}`;
    }

    // Update Twitter bio
    const bioElement = document.querySelector('.profilePanel:nth-child(3) #profileStatus');
    if (bioElement && twitter.description) {
        bioElement.textContent = twitter.description;
    }

    // Update Twitter stats
    const statsElements = document.querySelectorAll('.profilePanel:nth-child(3) .socialButtons #numberTitle');
    if (statsElements.length >= 3) {
        // Update tweets count
        if (twitter.tweets !== undefined && statsElements[0]) {
            statsElements[0].textContent = twitter.tweets;
        }

        // Update following count
        if (twitter.following !== undefined && statsElements[1]) {
            statsElements[1].textContent = twitter.following;
        }

        // Update followers count
        if (twitter.followers !== undefined && statsElements[2]) {
            statsElements[2].textContent = twitter.followers;
        }
    }

    // Update Twitter profile picture (if path provided)
    if (twitter.profile_image_path) {
        const imgElement = document.querySelector('.profilePanel:nth-child(3) .profileImg');
        if (imgElement) {
            imgElement.src = twitter.profile_image_path;
        }
    }
}

// Function to update the UI with fetched data
async function updateSocialProfilesUI() {
    // Fetch the data
    const data = await fetchSocialData();

    if (!data) {
        console.error('Could not update social profiles: No data available');
        return;
    }

    // Update both social media panels with all available data
    updateInstagramPanel(data);
    updateTwitterPanel(data);
}

// Initial update when page loads
document.addEventListener('DOMContentLoaded', () => {
    // Hide all loading overlays permanently
    const loadingOverlays = document.querySelectorAll('.loading-overlay');
    loadingOverlays.forEach(overlay => {
        overlay.style.display = 'none';
    });

    // Perform one-time update of social media profiles
    updateSocialProfilesUI();
});